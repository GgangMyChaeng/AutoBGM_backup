<div id="autobgm_settings">
  <div class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
      <b>AutoBGM</b>
      <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>

    <div class="inline-drawer-content">

      <!-- 1) Now Playing -->
      <div class="autobgm-nowplaying" style="margin-top:10px; padding:8px 10px; border:1px solid rgba(255,255,255,.12); border-radius:10px; background:rgba(0,0,0,.18);">
        <small style="opacity:.75;">Now Playing</small>
        <div style="display:flex; gap:8px; align-items:center; margin-top:4px;">
          <b id="autobgm_now_title" style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap; flex:1;">(none)</b>
          <small id="autobgm_now_state" style="opacity:.7; white-space:nowrap;">Stopped</small>
        </div>
        <small id="autobgm_now_meta" style="opacity:.65; display:block; margin-top:2px;">—</small>
        <div id="autobgm_now_debug" class="autobgm-now-debug" style="display:none;"></div>

        
        <!-- Now Playing controls (side menu) -->
  <div id="autobgm_now_controls" class="autobgm-now-controls">
  <button type="button" id="autobgm_now_btn_default" class="menu_button autobgm-now-btn" title="Use Default">
    ☆
  </button>
  <button type="button" id="autobgm_now_btn_play" class="menu_button autobgm-now-btn autobgm-now-btn-play" title="Play / Pause">
    ⏹️
  </button>
  <button type="button" id="autobgm_now_btn_mode" class="menu_button autobgm-now-btn" title="Play Mode">
    ▶️
  </button>
  <button type="button" id="autobgm_now_btn_kwonce"
          class="menu_button autobgm-now-btn"
          title="Keyword: Loop">
    🔁
  </button>
</div>
      </div>

      <!-- 2) Enabled 버튼 -->
      <div class="autobgm-menublock" style="margin-top:10px;">
        <div id="autobgm_enabled_btn" class="menu_button autobgm-menu-btn" title="Enabled">
          <i id="autobgm_enabled_icon" class="fa-solid fa-power-off"></i>
          <span id="autobgm_enabled_state" class="autobgm-menu-state">Off</span>
        </div>
      </div>

      <!-- 3) 사용방법 버튼 -->
      <div class="autobgm-menublock">
        <div id="autobgm_help_toggle" class="menu_button autobgm-menu-btn" title="Help">
          <i class="fa-solid fa-book"></i>
        </div><div id="autobgm_help_text" class="autobgm-helptext" style="display:none;">
          <b># 설명</b>
  <ul><li>
    <strong>Now Playing: </strong>
    현재 재생 중인 곡 등의 상태를 확인하거나 특정 기능들을 간단히 조작할 수 있는 작은 창.
    키워드 모드를 포함한 다섯 가지 재생 모드 중 무엇인지, 현재 재생 중인 곡은 어느 프리셋의 파일인지,
    재생 중인지 정지 중인지 등을 확인할 수 있음. 이외에 후술할 디버그 모드를 통해 다른 정보도 확인 가능.
    <ul>
      <li>
        <strong>☆(Use Default: OFF) / ⭐(Use Default: ON): </strong>
        "use default when no keyword" 기능을 사용할지 여부를 바꿔주는 버튼. 해당 기능은 키워드 모드에서 유의미함.
        ☆는 해당 기능 비활성화, ⭐는 해당 기능 활성화.
      </li>
      <li>
        <strong>⏹️(Stopped) / ⏸️(Paused) / ▶️(Playing): </strong>
        현재 재생 상태를 조작할 수 있는 버튼. ⏹️는 현재 확장이 비활성화 상태일 때 뜸.
        이 상태에서는 재생 버튼이나 재생 모드 조작 버튼이 아예 안 눌릴 거임.
        작동하려면 확장을 켜주면 됨. ⏸️는 현재 일시정지 상태. ▶️는 현재 재생 중인 상태.
      </li>
      <li>
        <strong>▶️(Manual) / 🔂(Loop One) / 🔁(Loop List) / 🔀(Random) / 💬(Keyword): </strong>
        재생 모드를 바꿀 수 있는 버튼.
        ▶️는 단일 모드로, 한 곡 재생해두면 종료 후 그대로 끝남.
        🔂는 단일 무한 재생 모드(Loop One).
        🔁는 현재 프리셋의 BGM들을 Sort로 설정한 순서대로 무한 재생해 주는 리스트 루프 모드(Loop List).
        🔀는 현재 프리셋의 BGM들을 랜덤(Random)으로 재생해 주는 모드.
        💬는 키워드 인식 기반의 로직에 따라 재생해 주는 모드(Keyword).
        여기서 키워드 모드란, Ai의 마지막 메시지에서 키워드가 인식되면 자동으로 해당 BGM이 조건에(키워드 인식, 우선도 등) 따라 자동 재생되는 기능임.
      </li>
    </ul>
  <li><strong>Enabled(전원 모양): </strong>해당 확장을 활성화 / 비활성화 시킬 수 있음</li>
    <li>
    <strong>Debug(무당벌레): </strong>
    지금 확장이 제대로 돌아가고 있는지 <strong>Now Playing</strong>에서 확인할 수 있음.
    기본적으로 보이는 건 <strong>asstLen</strong>이고, 키워드 모드 활성화 시 <strong>kw</strong>와 <strong>hit</strong>가 추가로 보임.
    즉, 키워드 설정을 해두고 제대로 매칭됐는지 확인하는 용도로 사용 가능.
    <ul>
      <li>
        <strong>asstLen: </strong>
        마지막 AI 메시지의 공백 및 줄바꿈 포함 글자 수(UTF-16 코드 유닛 기준).
        키워드 모드가 아닐 때는 글자 수 뒤에 "kw"와 "hit" 대신, 현재 인식한 컨텍스트의 초반 몇 글자를 보여줌.
      </li>
      <li><strong>kw: </strong>현재 마지막 AI 메시지 기준으로 어떤 키워드들이 트리거 됐는지 보여줌</li>
      <li><strong>hit: </strong>로직에 따라 <strong>최종적으로</strong> 결정된 곡(1개)을 보여줌</li>
    </ul>
  </li>
  <li><strong>Settings(톱니바퀴): </strong>해당 확장의 모달을 열어 상세 설정을 할 수 있음</li>
</ul>
        </div>
      </div>

      <!-- 4) Debug 버튼 -->
      <div class="autobgm-menublock" style="margin-top:8px;">
      <div id="autobgm_debug_btn" class="menu_button autobgm-menu-btn" title="Debug: OFF">
  <i class="fa-solid fa-bug"></i>
</div>

      <!-- 5) Settings 버튼 -->
      <div class="autobgm-menublock" style="margin-top:8px;">
        <div id="autobgm_open" class="menu_button autobgm-menu-btn" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </div>
      </div>

    </div>
  </div>
</div>
